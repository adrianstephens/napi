// See https://go.microsoft.com/fwlink/?LinkId=733558
// for the documentation about the tasks.json format
{
	"version": "2.0.0",
	"tasks": [

		{
			"label": "Get Native Dev Headers for VS Code",
			"type": "shell",
			"command": "node",
			"args": ["get-headers.js", "${execPath}", "electron"],
			"problemMatcher": []
		},
		{
			"type": "shell",
			"label": "Build NAPI",
			"command": "clang-cl",
			"args": [
				"-I", "include",
				"-I", "electron\\include\\node",
				"/LD",
				"-g",
				"-std:c++17",
				"/TP",

				"example\\example.cpp",
				"-DWIN32_LEAN_AND_MEAN", "-D_CRT_SECURE_NO_WARNINGS", "-DNOMINMAX",
				"-o", "out\\example.node",
				"-link","/DELAYLOAD:node.exe",
				"electron\\node.lib",
				//"/DEFAULTLIB:Delayimp.lib", 
			],
			"problemMatcher": {
				"owner": "cpp",
				"fileLocation": "absolute",
				"pattern": [
					{
						"regexp": "^(.*)\\((\\d+),(\\d+)\\):\\s+(warning|error|fatal error):\\s+(.*)",
						"file": 1,
						"line": 2,
						"column": 3,
						"severity": 4,
						"message": 5
					},
					{
						"regexp": "^\\s+([a-zA-Z].*)",
						"message": 1
					}
				]
			},
			"group":  "build",
		},
		{
			"type": "shell",
			"label": "prepublish",
			"command": "git add .; npm version ${input:version} --force",
			"windows": {
				"command": "git add . & npm version ${input:version} --force",
			},
			"problemMatcher": [],
		},
		{
			"type": "shell",
			"label": "PUBLISH",
			"command": "npm publish --access public",
			"problemMatcher": [],
			"dependsOn": "prepublish"
		},
		{
			"type": "shell",
			"label": "PACKAGE",
			"command": "npm pack",
			"problemMatcher": []
		},
	],
	"inputs": [
		{
			"id": "version",
			"description": "Version bump:",
			"type": "pickString",
			"options": ["patch", "minor", "major"],
			"default": "none"
		},
	]
}